"0","plot_hist <- function(data, var, treat, main = NULL, odds = FALSE,"
"0","                      breaks = 40, density = TRUE, xlim = NULL, ylim = NULL,"
"0","                      xlab = NULL, text.size = 0.8) {"
"0","  ntr <- sum(data[, treat] == 1)"
"0","  nco <- sum(data[, treat] == 0)"
"0","  if (odds == TRUE) {"
"0","    data[, var] <- log(data[, var]/(1-data[, var]))"
"0","    if (is.null(xlab) == TRUE) {xlab <- ""Log Odds""}"
"0","  } else {"
"0","    if (is.null(xlab) == TRUE) {xlab <- ""Propensity Score""}"
"0","  }"
"0","  if (is.null(xlim)) {"
"0","    if (odds == TRUE) {"
"0","      xlim <- range(data[, var])"
"0","      cat(xlim)"
"0","    } else {"
"0","      xlim <- c(0,1)"
"0","    }"
"0","  }"
"0","  intervals <- seq(xlim[1], xlim[2], length.out = breaks + 1)"
"0","  h0 <- as.numeric(table(cut(data[data[,treat]==0, var],"
"0","                             breaks = intervals, include.lowest = TRUE)))"
"0","  h1 <- as.numeric(table(cut(data[data[,treat]==1, var],"
"0","                             breaks = intervals, include.lowest = TRUE)))"
"0","  if (density == TRUE) {"
"0","    h0 <- h0/sum(h0); h1 <- h1/sum(h1)"
"0","  }"
"0","  s <- cbind.data.frame(h0, h1)"
"0","  if (is.null(ylim)) {"
"0","    ylim.max <- max(s$h0, s$h1) * 1.2"
"0","    ylim <- c(-ylim.max, ylim.max)"
"0","  }"
"0","  par(mar = c(4, 4, 1, 1))"
"0","  barplot(s$h0 * -1, names.arg = sprintf(""%.2f"", intervals[-1]),"
"0","          col = ""#AAAAAA80"", main = main, cex.lab = 1.3,"
"0","          ylim = ylim, xlab = xlab, cex.axis = 1.2, cex.names = 1.2,"
"0","          ylab = ""Density"", border = NA, axes = TRUE)"
"0","  barplot(s$h1, col = ""#ff000080"", add = TRUE,"
"0","          border = NA, cex.axis = 1.2)"
"0","  abline(h = 0, col = ""gray60"", lty = 2, lwd = 1.5)"
"0","  axis(1, at = seq(1, 60, length.out = breaks/2), labels = FALSE)"
"0","  usr <- par(""usr"")"
"0","  user_x <- usr[1] + 0.03 * (usr[2] - usr[1])"
"0","  user_y <- usr[3] + 0.92 * (usr[4] - usr[3])"
"0","  text(user_x, user_y, paste(""Ntr = "", ntr), pos = 4, cex = text.size)"
"0","  text(user_x, user_y - 0.05 * (usr[4] - usr[3]), paste(""Nco = "", nco),"
"0","       pos = 4, cex = text.size)"
"0","  box()"
"0","}"
